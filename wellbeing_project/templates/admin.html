{% extends "container.html" %}
{% load staticfiles filters%}
{% block title %}<img src="{% static 'assets/images/com_icon.jpg' %}" alt="" width="40px" class="img-fluid"> {{title}}{% endblock %}
{% load crispy_forms_tags %}
{% block content %}

<style>
.companies-name{
    text-transform:none;
}
</style>

<section class="main-section">


    <!-- Main Content -->
    <ul class="nav nav-pills nav-fill " id="myTab" role="tablist">

        <li class="nav-item ">
            <a class="nav-link " id="companies-tab" data-toggle="tab" href="#companies" role="tab" aria-controls="home"
                aria-selected="true">Companies </a>
                
        </li>

    </ul>
    <div class="tab-content">
        <div class="tab-pane card-body " id="companies" role="tabpanel" aria-labelledby="companies-tab" >
            <div class="table-responsive-md  company-table" >

                <table id="dtBasicExample1" class="table table-striped table-bordered table-sm nowrap" cellspacing="0"
                    width="100%"  >
            
                    <thead>
                        <tr>
                            <th>Company Name</th>
                            <th>Registration link</th>
                            <th>Project Manager</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for company in companies %}
                        <tr> 
                           <td class='companies-name' id='cname{{company.id}}'><a href='{% url "user_info"  company.tenant.id %}'>{{company.tenant.company_name}}</a></td>
                            <td class="companies-name">{{company.domain}}/registration</td>
                            <td class="companies-name">
                            {% comment %} {{company.id|get_project_manager}} {% endcomment %}
                           {{company.tenant.project_manager_email}}
                            </td>
                            <td><a data-toggle="modal" class="open-ConfirmationDialog" data-id="{{company.id}}"
                                    data-mode="company" href="#deleteRecord"><i
                                        class="material-icons">
                                        delete
                            </i></a></td>

                        </tr>
                        {% endfor %}
                    </tbody>
                
                </table>
           
            </div>
            <footer>
                    <div class="btn-container text-right " style='margin-top:0%;'>
                        <a data-toggle="modal" href="#addRecord" class="open-AddDialog btn btn-default mt-3">+ Add</a>
                    </div>
                </footer>
        </div>
        
    </div>

    <!-- Delete Model View -->
    <div class="modal hide" id="deleteRecord">

        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Delete Alert</h5>

                </div>
                <div class="modal-body">
                    {% comment %} <input type="text" name="bookId" id="bookId" value="" /> {% endcomment %}
                    <form id="bookId" action="" method="post">{% csrf_token %}
                        <p id="alert-msg"></p>
                        <hr>
                        <div class="agree-sec m-0">
                            <div class="btn-container text-center ml-auto ">
                                <button type="submit" class="btn btn-default text-uppercase">Confirm</button>
                            </div>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>    

    <!-- Add/Create Modal View -->
    <div class="modal hide" id="addRecord">

            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Company Registration</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                            <form method="post" action="/registration/" enctype="multipart/form-data">
                                {% csrf_token %}

                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-4 mb-0">
                                            <label for=''>{{ form.domain.label }}</label>
                                        </div>
                                        <div class="col-md-8 mb-0">
                                            {{ form.domain }}
                                        </div>
                                    </div><br>
                                    <div class="row">
                                        <div class="col-md-4 mb-0">
                                            <label for=''>{{ form.company_name.label }}</label>
                                        </div>
                                        <div class="col-md-8 mb-0">
                                            {{ form.company_name }}
                                        </div>
                                    </div><br>
                                    <div class="row">
                                        <div class="col-md-4 mb-0">
                                            <label for=''>{{ form.project_manager_email.label }}</label>
                                        </div>
                                        <div class="col-md-8 mb-0">
                                            {{ form.project_manager_email }}
                                        </div>
                                    </div><br>
                                    <div class="row">
                                        <div class="col-md-4 mb-0">
                                            <label for=''>{{ form.company_logo.label }}</label>
                                        </div>
                                        <div class="col-md-8 mb-0">
                                            {{ form.company_logo }}
                                        </div>
                                    </div><br>
                                    <div class="row">
                                        <div class="col-md-4 mb-0">
                                            <label for=''>{{ form.pillar.label }}</label><br>
                                            <div class="row">
                                                <p style="color:red; margin;margin-left: 10px;">
                                                    ( Add Pillars one at a time on separate lines. )
                                                </p>  
                                            </div>
                                        </div>
                                        <div class="col-md-8 mb-0">
                                            {{ form.pillar }}
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4 mb-0">
                                            <label for=''>{{ form.admin_pledge.label }}</label><br>
                                            <div class="row">
                                                <p style="color:red; margin;margin-left: 10px;">
                                                    (Add names one at a time on separate lines.)
                                                </p>  
                                            </div>
                                        </div>
                                        <div class="col-md-8 mb-0">
                                            {{ form.admin_pledge }}
                                        </div>
                                    </div>
                                    
                                </div>
                                <hr>
        
                                <div class="agree-sec m-0">
                                    <div class="btn-container text-center ml-auto ">
                                        <button type="submit" class="btn btn-default text-uppercase">register</button>
                                    </div>
                                </div>
                            </form>
                    </div>
                </div>
            </div>
        </div>    

</section>
{% endblock content %}
{% block scripts %}

   {% comment %} <!-- NEW ADDED SCRIPT -->
    <script src="{% static 'assets/js/jquery-3.1.1.min.js' %}"></script>
    <script src='https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js'></script>
    <!-- END -->  {% endcomment %}
    

 <script src="{% static 'assets/js/jquery.dataTables.min.js'%}"></script>
 <script src="{% static 'assets/js/dataTables.bootstrap4.min.js'%}"></script>
<script>
    $(document).ready(function () {
       $(document).ready(function() {
      /*  $('#dtBasicExample1').DataTable({
            //"lengthMenu": [[2, 4, 8, -1], [2, 4, 8, "All"]],
           // "pageLength": 4,
            "scrollY":'250px',
            "bInfo" : false,
            'paging':false,
            "columnDefs":[{
                "targets": [0,1,2],
                "bSortable": false,
                "createdCell": function (td, cellData, rowData, row, col) {
                        $(td).css ('text-transform','unset');
                        }
                    },],
        }); */
        } );
        
      
        
        $('#dtBasicExample2').DataTable({
            "lengthMenu": [[2, 4, 8, -1], [2, 4, 8, "All"]],
            "pageLength": 4,
            
            'columnDefs': [
                {
                    "targets": 3,
                    "className": "text-center",

                }]
        });
        $('#dtBasicExample3').DataTable({
            "lengthMenu": [[2, 4, 8, -1], [2, 4, 8, "All"]],
            "pageLength": 4,
            'columnDefs': [
                {
                    "targets": 3,
                    "className": "text-center",

                }]
        });
    });

</script>
<script>
    $(function () {
        $('#myTab li:first-child a').tab('show')
    });



    $(document).on("click", ".open-ConfirmationDialog", function () {
        var pk = $(this).data('id');
        //alert(pk)
        var cname = $('#cname'+pk).text();
        //$(".modal-body #alert-msg").text("Are you sure you want to delete "+$(this).data('mode')+" ?");
        $(".modal-body #alert-msg").text("Are you sure you want to delete "+cname);
            if($(this).data('mode')=='company'){
                $(".modal-body #bookId").attr("action","/registration/delete/"+pk+"/");
            }
    });

    $(document).on("click", ".open-AddDialog", function () {
        
    });
</script>
{% endblock scripts %}